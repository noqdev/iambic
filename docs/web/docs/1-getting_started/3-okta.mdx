---
title: Okta
---

In this tutorial, you will configure IAMbic to manage an Okta Organization, and then
practice using IAMbic to to create, manipulate, and expire a test group and test app assignment.

#### Setup
1. Create a basic Okta configuration for Iambic
1. Import existing Okta Groups into your IAMbic templates repository

#### Practice
1. Create an Okta Group with one or more users
1. Add a user to the group
1. Provide temporary ("break-glass") access to an Okta Group
1. Expire a group membership
1. Expire a group
1. Create an application assignment
1. Provide temporary ("break-glass") access to an application

<!-- #TODO As with the google page, these headings should link to, and match, headings below -->

## Prerequisities

Before you begin, you will need the following:

* A local Git repository to store your IAMbic templates (See [Install and Configure](/getting_started/install_and_configure) for guidance on setting this up)
* Administrative access to an existing Okta organization. If you do not have one, you can
create a developer organization at [developer.okta.com](https://developer.okta.com/).

We'll start by setting environment variables to make it easier to run the commands in this tutorial.
These environment variables will be used in the subsequent commands on this page, and aren't needed
for regular IAMbic usage. In a production environment, we recommend storing these values
in AWS Secrets Manager and extending the IAMbic configuration to load them during runtime.

<!--
Email: <input type="text" id="inputOktaEmail" value="user@example.com" onInput={() => updateText(document.getElementById('inputOktaEmail'), 'outputOktaEmail')} />

Okta Domain: <input type="text" id="inputOktaDomain" value="https://dev-12345.okta.com/" onInput={() => updateText(document.getElementById('inputOktaDomain'), 'outputOktaDomain')} />

IdP Name: <input type="text" id="inputOktaIdpName" onInput={() => updateText(document.getElementById('inputOktaIdpName'), 'outputOktaIdpName')} />

Okta API Token: <input type="text" id="inputOktaApiToken" value="s3cr3tOktaToken" onInput={() => updateText(document.getElementById('inputOktaApiToken'), 'outputOktaApiToken')} />
-->

```bash
export EMAIL=<your_okta_email_address>
export OKTA_DOMAIN=<your_okta_domain> # ex: https://dev-12345.okta.com/, you get the `dev-12345` portion, specific to your environment from the Okta portal.
export OKTA_ORG_NAME=<your_okta_org_name> # ex: development. This is a friendly name to identify your Okta organization.  Any arbitrary string will work here.
export OKTA_API_TOKEN=<your_okta_api_token> # An administrative API token for your Okta organization, follow the instructions in the following steps to create one.
```

## Setup

###  1. Configure iambic for Okta management

You have a few options for configuring IAMbic to manage your Okta Organization. You can either:

1. Use the setup wizard to configure IAMbic (`iambic setup`)
1. Write your Okta configuration manually

If you use the setup wizard, you'll first need to configure an AWS account. As a part of the setup process,
IAMbic will create an AWS Secret to store your Okta API token. If you choose to configure IAMbic manually,
you can either leverage AWS Secrets Manager to store your token, or you can store it in a local file that
will be merged into your IAMbic configuration but won't be checked into your `iambic-templates` Git repository.

The steps below will walk you through configuring IAMbic manually.

#### Manually Configure IAMbic

In this section, you will create an API token that allows iambic to manage application and group memberships by
signing in to Okta.

From within Okta
1. Click on Security
1. Click on API
1. Click on Tokens
1. Click on "Create Token"
1. Create a token for Iambic. This token will be used to authenticate Iambic with Okta.
1. Copy the value of the token.


<details>
  <summary>Screenshot</summary>

![Okta-token](/img/okta/okta-token-1.png)

</details>

With your token in hand, create `config/secrets.yaml`
in your `iambic-templates` Git repo if it doesn't already exist:

:::danger

Never commit secrets Git. Ensure that you have a  `.gitignore` file in the root directory of your `iambic-templates`
repository that is configured to ignore secrets.yaml files with `**/secrets.yaml`. [Learn more](https://git-scm.com/docs/gitignore) about `.gitignore` files.

:::

As a reminder and in case you did not export the bash variables in the `Prerequisities` section:

* OKTA_DOMAIN=<your_okta_domain> # ex: https://dev-12345.okta.com/, you get the `dev-12345` portion, specific to your environment from the Okta portal.
* OKTA_ORG_NAME=<your_okta_org_name> # ex: development. This is a friendly name to identify your Okta organization. Any arbitrary string will work here.
* OKTA_API_TOKEN=<your_okta_api_token> # An administrative API token for your Okta organization


```bash
cat <<EOF > config/secrets.yaml
secrets:
  okta:
    - idp_name: $OKTA_ORG_NAME
      org_url: $OKTA_DOMAIN
      api_token: $OKTA_API_TOKEN
EOF
```

From the base directory of your IAMbic templates repository, your directory structure should resemble the following. You may
have more files if you've recently imported your cloud resources.

```bash
tree .
.
├── config
│   ├── config.yaml
│   └── secrets.yaml
```

### 2. Import existing Okta Groups


In this section, you will manually import existing Okta Groups into your IAMbic templates repository. In a production environment, automation provided by Iambic would ensure that Git is updated with the
cloud resources in your production environment. This allows you to monitor the history of these groups via Git History.

Run the following command in the root of your `iambic-templates` repository to import your existing Okta Groups:

```bash
iambic import
```

If you have Okta Groups defined, your iambic-templates repository should have a `okta/groups` directory with a subdirectory for each Okta organization you have defined.

That's it, you've completed the setup configuration connecting your Okta Groups to IAMBic. Now you will practice using IAMbic to execute basic group management skills.

## Practice
### 3. Create an Okta Group

Iambic uses a YAML file to describe the desired state of an Okta Group. In this section, we will create a group called `iambic-test-group` in your domain. Ensure that the environment variables you've set previously are still configured, and also ensure that your credentials are working properly by running the import process from the previous section.

Run the following set of commands from the root of your `iambic-templates` repository to create a new Okta Group template:

```bash
mkdir -p okta/groups/$OKTA_IDP_NAME
cat <<EOF > okta/groups/$OKTA_IDP_NAME/iambic-test-group.yaml
template_type: NOQ::Okta::Group
properties:
  name: iambic-test-group
  description: ''
  idp_name: development
  members:
    - username: $EMAIL
EOF
```


Apply the template to your Okta Organization by running the following command:

:::info

In a production environment, this would be handled by a command issued on a Github Pull Request after the appropriate approvals have been made.

:::

```bash
iambic apply okta/groups/$OKTA_IDP_NAME/iambic-test-group.yaml
```

Confirm that the group has been created by running the following command and visiting the URL in your browser:

```bash
echo https://$OKTA_DOMAIN/admin/groups
```

By now the directory of your `iambic-templates` repository should resemble the following, and may include other resources that you've imported:

```bash
$ tree .
.
├── config
│   ├── config.yaml
│   └── secrets.yaml
├── okta
│   └── groups
│       └── $OKTA_IDP_NAME
│           ├── iambic-test-group.yaml
```

### 4. Add a user to the group

In this section, we will add a user (`testuser@example.com`) to the group we created in the previous section.
`example.com` is a reserved domain for tests and example use cases, and `testuser@example.com` is not a real user.

Run the following command to replace the previous group you created with a new one that includes the new user:

```bash
cat <<EOF > okta/groups/$OKTA_IDP_NAME/iambic-test-group.yaml
template_type: NOQ::Okta::Group
properties:
  name: iambic-test-group
  description: ''
  idp_name: $OKTA_IDP_NAME
  email: iambic-test-group@$DOMAIN
  members:
    - email: $EMAIL
      role: OWNER
    - email: testuser@example.com
EOF
```

Run the `apply` command to have IAMbic update the group:

```bash
iambic apply okta/groups/$OKTA_DOMAIN/iambic-test-group.yaml
```

### 5. Provide temporary ("break-glass") access to an Okta Group

In this section, we will update the group added in the previous section to configure the access to expire in two minutes,
simulating a very short breakglass request. In order to strive for least privilege while accomodating this request,
we will add an expiration date to the user's membership in the group. Run the following command to replace the previous
group you created with a new one that includes the additional user and an expiration date, and then apply that change:

:::tip

If a specific expiration date is provided without a timezone, Iambic will assume the timezone is UTC.
If a timezone is provided, Iambic will use that timezone.

:::

```bash
cat <<EOF > okta/groups/$OKTA_IDP_NAME/iambic-test-group.yaml
template_type: NOQ::Okta::Group
properties:
  name: iambic-test-group
  description: ''
  idp_name: $OKTA_IDP_NAME
  members:
    - username: $EMAIL
      expires_at: in 2 minutes
EOF
```

```bash
iambic apply okta/groups/$OKTA_IDP_NAME/iambic-test-group.yaml
```

After applying the change, notice that the `expires_at` date in the template was converted from a relative expiration time ("in two minutes") to an absolute date (Example: "2021-05-20T15:00:00-04:00"). This allows Iambic to know exactly when the request should be expired.

Confirm that the user was added by visiting the following URL in your browser:

```bash
echo https://$OKTA_DOMAIN/admin/groups
```

After a couple of minutes, the request should expire. In a production deployment, this process would be automatic. But for the purposes of testing, you can manually expire the request by re-running the apply command after two minutes have passed:

```bash
iambic apply okta/groups/$OKTA_IDP_NAME/iambic-test-group.yaml
```


### Expire? Maybe? #TODO

<!-- #TODO Do something here to confrim it's expired properly -->

## Conclusion
That's it! You've now connected Okta to IAMbic, and are able to create and edit your groups, and expire users and groups. <!-- #TODO or whichever subset of users and groups we actaully are demonstrating. -->